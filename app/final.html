<html>
<head><title>Final progress</title>
  <link rel="stylesheet" href="final.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js" charset="utf-8"></script>
	<script src = "https://d3js.org/d3-axis.v1.min.js"></script>
</head>
<body>
  <svg id="visualisation" width="500" height="500"></svg>
  <svg id="visualisation2" width="500" height="500"></svg>

  <script type="text/javascript">
  
  let start = Date.now();
	  //initial empty data
	  var lineData = []; 
	  var lineData2 = [];
	  
	  //set the dimensions
	  var margin = {
        top: 20,
        right: 20,
        bottom: 20,
        left: 50
      },
      width = 1000,
      height = 500;
      
    //https://www.sitepoint.com/creating-simple-line-bar-charts-using-d3-js/#:~:text=Weâ€™ll%20be%20using%20d3.svg.line%20%28%29%20to%20draw%20our,is%20how%20we%20define%20the%20line%20generator%20function%3A
    //set the ranges
      xRange = d3.scale.linear().range([margin.left, width - margin.right]).domain([0, 2000]),
      yRange = d3.scale.linear().range([height - margin.top, margin.bottom]).domain([0,40]),
      //define the axes
      xAxis = d3.svg.axis()
        .scale(xRange)
        .tickSize(5)
        .tickSubdivide(true),
      yAxis = d3.svg.axis()
        .scale(yRange)
        .tickSize(5)
        .orient('left')
        .tickSubdivide(true);
    
      //define the line
     var lineFunc = d3.svg.line()
        .x(function(d) {
          return xRange(d.x);
        })
        .y(function(d) {
          return yRange(d.y);
        })
        .interpolate('linear');
      
    //add svg canvas
    //this vis is only goint to give the domain with the original data
    var vis = d3.select('#visualisation') 
    //add x axis
    var x = vis.append('svg:g')
      .attr('class', 'x axis')
      .attr('transform', 'translate(0,' + (height - margin.bottom) + ')')
      .call(xAxis);
  
    //add y axis
    vis.append('svg:g')
      .attr('class', 'y axis')
      .attr('transform', 'translate(' + (margin.left) + ',0)')
      .call(yAxis);
    
    //this is what needs to be transitioned each time when it updates
    //add valueline path
    var toUpdate = vis.append('svg:path')
      .attr('d', lineFunc(lineData))
      .attr('stroke', 'blue')
      .attr('stroke-width', 2)
      .attr('fill', 'none');
    
    var anotherUpdate = vis.append('svg:path')
      .attr('d', lineFunc(lineData2))
      .attr('stroke', 'green')
      .attr('stroke-width', 2)
      .attr('fill', 'none');
    
    //second graph
    var vis2 = d3.select('#visualisation2')
    var x2 = vis2.append('svg:g')
      .attr('class', 'x axis')
      .attr('transform', 'translate(0,' + (height - margin.bottom) + ')')
      .call(xAxis);
    
    vis2.append('svg:g')
      .attr('class', 'y axis')
      .attr('transform', 'translate(' + (margin.left) + ',0)')
      .call(yAxis);
      
    //this is what needs to be transitioned each time when it updates
    var toUpdate2 = vis2.append('svg:path')
      .attr('d', lineFunc(lineData))
      .attr('stroke', 'blue')
      .attr('stroke-width', 2)
      .attr('fill', 'none');
      
    var anotherUpdate2 = vis2.append('svg:path')
      .attr('d', lineFunc(lineData2))
      .attr('stroke', 'green')
      .attr('stroke-width', 2)
      .attr('fill', 'none');
    
    var ms_between_updates = 100;
    var value = 20;
    var valueGreen = 20;
  
    function simulate () {
      //get another value
      if (Math.random() < 0.5) {
        value -= 1;
      } else {
        value += 1;
    }
    if (Math.random() < 0.5) {
      valueGreen -= 1;
    } else {
      valueGreen += 1;
    }
    let now = Date.now();
    var value2 = now - start;

    // add this data to an existing data source...
    lineData.push({x: value2,y: value});
    lineData2.push({x: value2,y: valueGreen});
    //lineData = lineData.slice(-20);
    // lineData2 = lineData2.slice(-20);
    //now need to call .transition
    toUpdate.transition()
      .attr('d', lineFunc(lineData))
    anotherUpdate.transition()
      .attr('d', lineFunc(lineData2))
    toUpdate2.transition()
      .attr('d', lineFunc(lineData))
    anotherUpdate2.transition()
      .attr('d', lineFunc(lineData2))
    //changing the domain
    xRange = d3.scale.linear().range([margin.left, width - margin.right]).domain([0, d3.max(lineData, function(d) {
      return d.x;
    })])
    //update the axis to show the change
    xAxis = d3.svg.axis()
      .scale(xRange)
      .tickSize(5)
      .tickSubdivide(true)
   x.transition().call(xAxis)
    x2.transition().call(xAxis)
    }
  
  function start_simulation() {
    interval_id = setInterval(simulate, ms_between_updates);
  }
  start_simulation();
  
  
  function start_app() {
    this.final.start_simulation();
  }

  function stop_app() {
    this.final.end_simulation();
  }

  function clear_app() {
    this.final.clear_simulation();
  }

  </script>

  <form>
    <input type = "button" value="start" onClick="JavaScript:start_app()">
    <!-- ; JavaScript:GIF()"> -->
    <input type = "button" value="end" onClick="JavaScript:stop_app()">
    <input type = "button" value="clear" onClick="JavaScript:clear_app()">
  </form>

  <body>
        <b>Values at initialization:</b><br>
          Total number of pedestrians on grid: <span id="total_peds_at_start"></span><br>
          Children: <span id="num_Child_initial"></span><br>
          Adults: <span id="num_Adult_initial"></span><br>
          Adults with backpacks: <span id="num_AdultBackpack_initial"></span><br>
          Adults with bikes: <span id="num_AdultBike_initial"></span><br>
          Obstacles: <span id="num_Obstacle_initial"></span><br>
    <table>
      <tr valign=top>
        <td><canvas id="grid" width="600" height="600"></canvas></td>
        <td valign=top>
          
          <h2>Statistics</h2>
          
          <b>Current number of pedestrians on grid:</b><br>
          Children: <span id="current_Child"></span><br>
          Adults: <span id="current_Adult"></span><br>
          Adults with backpacks: <span id="current_AdultBackpack"></span><br>
          Adults with bikes: <span id="current_AdultBike"></span><br>
          Total: <span id="current_total"></span><br>


          <b>Collision data:</b><br>
          Average number of collisions: <span id="avg_collide"></span><br>
          Total number of collisions: <span id="collide"></span><br>
          Average number of collisions for children: <span id="avg_Child_collide"></span><br>
          Total number of collisions for children: <span id="total_Child_collide"></span><br>
          Average number of collisions for adults: <span id="avg_Adult_collide"></span><br>
          Total number of collisions for adults: <span id="total_Adult_collide"></span><br>
          Average number of collisions for adults with backpacks: <span id="avg_AdultBackpack_collide"></span><br>
          Total number of collisions for adults with backpacks: <span id="total_AdultBackpack_collide"></span><br>
          Average number of collisions for adults with bikes: <span id="avg_AdultBike_collide"></span><br>
          Total number of collisions for adults with bikes: <span id="total_AdultBike_collide"></span><br>

          <b>Exit time data (in seconds)</b><br>
          Average exit time: <span id="avg_exit_time"></span><br>
          Total exit time: <span id="total_exit_time"></span><br>
          Average exit time for children: <span id="avg_exit_Child"></span><br>
          Total exit time for children: <span id="total_Child_exit"></span><br>
          Average exit time for adults: <span id="avg_exit_Adult"></span><br>
          Total exit time for adults: <span id="total_Adult_exit"></span><br>
          Average exit time for adults with backpacks: <span id="avg_exit_AdultBackpack"></span><br>
          Total exit time for adults with backpacks: <span id="total_AdultBackpack_exit"></span><br>
          Average exit time for adults with bikes: <span id="avg_exit_AdultBike"></span><br>
          Total exit time for adults with bikes: <span id="total_AdultBike_exit"></span><br>

          <b>Waiting time data</b><br>
          Average waiting time: <span id="avg_wait_steps"></span><br>
          Total waiting time: <span id="total_wait_steps"></span><br>
          Average waiting time for children: <span id="avg_wait_steps_Child"></span><br>
          Total waiting time for children: <span id="total_Child_wait"></span><br>
          Average waiting time for adults: <span id="avg_wait_steps_Adult"></span><br>
          Total waiting time for adults: <span id="total_Adult_wait"></span><br>
          Average waiting time for adults with backpacks: <span id="avg_wait_steps_AdultBackpack"></span><br>
          Total waiting time for adults with backpacks: <span id="total_AdultBackpack_wait"></span><br>
          Average waiting time for adults with bikes: <span id="avg_wait_steps_AdultBike"></span><br>
          Total waiting time for adults with bikes: <span id="total_AdultBike_wait"></span><br>

          Minimum time possible with no obstacles: 

          <h2>Initialize the Simulation:</h2>

          <form>
            <label for="numChildren">Number of Children:</label><br>
            <input type="text" id="numChildren" name="numChildren"><br>
            <label for="numAdults">Number of Adults:</label><br>
            <input type="text" id="numAdults" name="numAdults"><br>
            <label for="numBackPacks">Number of Adults with Backpacks:</label><br>
            <input type="text" id="numBackPacks" name="numBackPacks"><br>
            <label for="numBikes">Number of Adults with Bikes:</label><br>
            <input type="text" id="numBikes" name="numBikes"><br>
            <label for="numExits">Number of Exits:</label><br>
            <input type="text" id="numExits" name="numExits"><br>
            <label for="numObstacles">Number of Obstacles:</label><br>
            <input type="text" id="numObstacles" name="numObstacles">
          </form>

          <h2>Board Initialization</h2>

          <form>
            <div class="slidecontainer">
              Time between updates: <input type="range" min="1" max="500" value="1" id="ms_speed"><br>
            </div>
            <div class="slidecontainer">
              Time to wait: <input type="range" min="1" max="500" value="1" id="wait_speed"><br>
            </div>
            <label for="gridWidthi">Width of Grid:</label><br>
            <input type="text" id="gridWidthi" name="gridWidthi"><br>
            <label for="gridWidthii">Height of Grid:</label><br>
            <input type="text" id="gridWidthii" name="gridWidthii"><br>

          </form>

          <h2>Take Snapshots</h2>

          <b>Take Snapshot images:</b> <input type="checkbox" id="takeSnapshot"><br>

          <h2>Choose Initial Layout</h2>
          <b>Lecture Hall:</b> <input type="checkbox" id="hallLayout"><br>
          <b>Fuller Lower:</b> <input type="checkbox" id="fullerLower"><br>
          <b>Classroom:</b> <input type="checkbox" id="classroom"><br>
          
          <h2>Choose Heuristic Function</h2>
          <b>Diagonal Distance:</b> <input type="checkbox" id="diagonal"><br>
          <b>Manhattan Distance:</b> <input type="checkbox" id="manhattan"><br>
          <b>Euclidean Distance:</b> <input type="checkbox" id="euclidean"><br>

        </td>
      </tr>
    </table>

    <h1>Sample outputs</h1>


    <script type='text/javascript' src='data.js'>    </script>
    <script type='text/javascript' src='gui.js'>    </script>
    <script type='text/javascript' src='heap.js'>    </script>
    <script type='text/javascript' src='astar.js'>    </script>
    <script type='text/javascript' src='pop.js'>    </script>
    <script type='text/javascript' src='final.js'>    </script>
    <script type="text/javascript" src="LZWEncoder.js">    </script>
    <script type="text/javascript" src="NeuQuant.js">    </script>
    <script type="text/javascript" src="GIFEncoder.js">    </script>
    <script type="text/javascript" src="b64.js">    </script>


  </body>
  </html>
